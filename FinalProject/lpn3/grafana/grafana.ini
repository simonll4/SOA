[server]
# URL base de Grafana
root_url = https://lpn3.crabdance.com
serve_from_sub_path = true

[auth]
# Deshabilitar login local si solo quieres usar Keycloak
disable_login_form = false
# Opcional: deshabilitar creación de usuarios desde la UI
disable_signout_menu = false

[auth.generic_oauth]
# OAuth habilitado
enabled = true
name = Keycloak
icon = signin

# Configuración del cliente
client_id = grafana
client_secret = aJuaXoYjsSQq7jiYUWx6kimkkhVv8GeN

# URLs de Keycloak
auth_url = https://keycloak.lpn1.crabdance.com/realms/SOA-2025/protocol/openid-connect/auth
token_url = https://keycloak.lpn1.crabdance.com/realms/SOA-2025/protocol/openid-connect/token
api_url = https://keycloak.lpn1.crabdance.com/realms/SOA-2025/protocol/openid-connect/userinfo

# Scopes - incluir roles personalizados
scopes = openid profile email roles

# Registro automático y configuración de usuario
allow_sign_up = true
auto_login = false

# MAPEO DE ROLES CORREGIDO - Basado en los logs, usas 'grafana_roles'
role_attribute_path = contains(grafana_roles[*], 'grafana-admin') && 'Admin' || contains(grafana_roles[*], 'grafana-editor') && 'Editor' || 'Viewer'

role_attribute_strict = true

# Mapeo de información del usuario
login_attribute_path = preferred_username
name_attribute_path = name
email_attribute_path = email

# IMPORTANTE: Para que simonll4 sea admin
allow_assign_grafana_admin = true
skip_org_role_sync = false

# Configuración de grupos (opcional, para organizaciones múltiples)
groups_attribute_path = groups
org_attribute_path = 
org_mapping = 

# Seguridad
use_pkce = true
use_refresh_token = true
tls_skip_verify_insecure = false

# Configuración de sesión
token_url_params = 
empty_scopes = false

[security]
# Configuraciones de seguridad
admin_user = admin
admin_password = admin123
secret_key = SW2YcwTIb9zpOOhoPsMm
disable_gravatar = false

[users]
# Permitir a usuarios crear organizaciones
allow_org_create = false
# Auto-asignar usuarios a la organización principal
auto_assign_org = true
auto_assign_org_id = 1
auto_assign_org_role = Viewer

[log]
mode = console
level = debug

# Logs específicos para OAuth debugging
[log.filters]
oauth = debug
auth = debug
login = debug



; [server]
; # URL base de Grafana
; root_url = https://lpn3.crabdance.com
; serve_from_sub_path = true

; [auth]
; # Deshabilitar login local si solo quieres usar Keycloak
; disable_login_form = false
; # Opcional: deshabilitar creación de usuarios desde la UI
; disable_signout_menu = false

; [auth.generic_oauth]
; # OAuth habilitado
; enabled = true
; name = Keycloak
; icon = signin

; # Configuración del cliente
; client_id = grafana
; client_secret = aJuaXoYjsSQq7jiYUWx6kimkkhVv8GeN

; # URLs de Keycloak
; auth_url = https://keycloak.lpn1.crabdance.com/realms/SOA-2025/protocol/openid-connect/auth
; token_url = https://keycloak.lpn1.crabdance.com/realms/SOA-2025/protocol/openid-connect/token
; api_url = https://keycloak.lpn1.crabdance.com/realms/SOA-2025/protocol/openid-connect/userinfo

; # Scopes
; scopes = openid profile email groups

; # IMPORTANTE: Permitir registro automático
; allow_sign_up = true
; auto_login = false

; # Mapeo de roles - corregido para usar 'roles' en lugar de 'groups'
; role_attribute_path = contains(resource_access.grafana.roles[*], 'admin') && 'Admin' || contains(resource_access.grafana.roles[*], 'editor') && 'Editor' || 'Viewer'
; role_attribute_strict = false

; # Mapeo de información del usuario
; login_attribute_path = preferred_username
; name_attribute_path = name
; email_attribute_path = email

; # Configuración adicional
; allow_assign_grafana_admin = true
; skip_org_role_sync = false

; # Opcional: forzar uso de HTTPS
; tls_skip_verify_insecure = false

; [security]
; # Configuraciones de seguridad
; admin_user = admin
; admin_password = admin123
; secret_key = SW2YcwTIb9zpOOhoPsMm
; disable_gravatar = false

; [users]
; # Permitir a usuarios crear organizaciones
; allow_org_create = false
; # Auto-asignar usuarios a la organización principal
; auto_assign_org = true
; auto_assign_org_id = 1
; auto_assign_org_role = Viewer

; [log]
; mode = console
; level = info

; #################################### SMTP / Emailing ##########################
; [smtp]                                                                                                                                                                     
; enabled = true                                                                                                                                                             
; host = smtp.gmail.com:587                                                                                                                                                  
; user = simon.llamosas44@gmail.com                                                                                                                                          
; # If the password contains # or ; you have to wrap it with triple quotes. Ex """#password;"""                                                                              
; password =nuuc pmjy skxa tfgf                                                                                                                                              
; cert_file =                                                                                                                                                                
; key_file =                                                                                                                                                                 
; skip_verify = false                                                                                                                                                        
; from_address = simon.llamosas44@gmail.com                                                                                                                                  
; from_name = Grafana                                                                                                                                                        
; # EHLO identity in SMTP dialog (defaults to instance_name)                                                                                                                 
; ehlo_identity = dashboard.example.com                                                                                                                                      
; # SMTP startTLS policy (defaults to 'OpportunisticStartTLS')                                                                                                               
; startTLS_policy =                                                                                                                                                          
; # Enable trace propagation in e-mail headers, using the 'traceparent', 'tracestate' and (optionally) 'baggage' fields (defaults to false)                                  
; enable_tracing = false